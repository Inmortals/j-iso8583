!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e,r){t.exports=r(4)},function(t,e){function r(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise(function(a,o){var i=t.apply(e,n);function s(t){r(i,a,o,s,c,"next",t)}function c(t){r(i,a,o,s,c,"throw",t)}s(void 0)})}}},function(t,e,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=r(5),a)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},function(t,e){!function(e){"use strict";var r,n=Object.prototype,a=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof t,h=e.regeneratorRuntime;if(h)u&&(t.exports=h);else{(h=e.regeneratorRuntime=u?t.exports:{}).wrap=w;var l="suspendedStart",f="suspendedYield",p="executing",v="completed",d={},y={};y[i]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(j([])));m&&m!==n&&a.call(m,i)&&(y=m);var b=L.prototype=k.prototype=Object.create(y);D.prototype=b.constructor=L,L.constructor=D,L[c]=D.displayName="GeneratorFunction",h.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===D||"GeneratorFunction"===(e.displayName||e.name))},h.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,L):(t.__proto__=L,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(b),t},h.awrap=function(t){return{__await:t}},M(T.prototype),T.prototype[s]=function(){return this},h.AsyncIterator=T,h.async=function(t,e,r,n){var a=new T(w(t,e,r,n));return h.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},M(b),b[c]="Generator",b[i]=function(){return this},b.toString=function(){return"[object Generator]"},h.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},h.values=j,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,a){return s.type="throw",s.arg=t,e.next=n,a&&(e.method="next",e.arg=r),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;A(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:j(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}}}function w(t,e,r,n){var a=e&&e.prototype instanceof k?e:k,o=Object.create(a.prototype),i=new N(n||[]);return o._invoke=function(t,e,r){var n=l;return function(a,o){if(n===p)throw new Error("Generator is already running");if(n===v){if("throw"===a)throw o;return B()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var s=E(i,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=x(t,e,r);if("normal"===c.type){if(n=r.done?v:f,c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=v,r.method="throw",r.arg=c.arg)}}}(t,r,i),o}function x(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function k(){}function D(){}function L(){}function M(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function T(t){var e;this._invoke=function(r,n){function o(){return new Promise(function(e,o){!function e(r,n,o,i){var s=x(t[r],t,n);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,o,i)},function(t){e("throw",t,o,i)}):Promise.resolve(u).then(function(t){c.value=t,o(c)},function(t){return e("throw",t,o,i)})}i(s.arg)}(r,n,e,o)})}return e=e?e.then(o,o):o()}}function E(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,E(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var a=x(n,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,d;var o=a.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function j(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(a.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return o.next=o}}return{next:B}}function B(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(t,e,r){"use strict";r.r(e);var n=r(2),a=r.n(n),o=r(3),i=r.n(o),s=r(0),c=r.n(s),u=r(1),h=r.n(u),l=function(){function t(){c()(this,t)}return h()(t,null,[{key:"bcdToAsc",value:function(t,e){var r="",n=0,a=t;arguments.length>=2&&(a=a.slice(0,e));for(var o=0;o<a.length;o++)r+=1===(n=a.charCodeAt(o).toString(16).toUpperCase()).length?"0".concat(n):n;return r.trim()}},{key:"ascToBcd",value:function(t,e){var r,n,a=[],o=t;if(!/[0-9a-fA-F]/m.test(o))throw new Error("Wrong Format!");if(o.length%2)throw new Error("Length not times to 2");arguments.length>=2&&(o=o.slice(0,e));for(var i=0;i<o.length/2;i++)n=o.substr(2*i,2),r=parseInt(n,16),a.push(r);return a=String.fromCharCode.apply(null,a)}},{key:"bitGet",value:function(t,e){if(e<0)return t;var r=parseInt(e/4,10),n=e%4;if(r>=t.length)throw new Error("length exceed ".concat(r));var a=t.charAt(r);return parseInt(a,16)>>3-n&1}},{key:"bitSet",value:function(t,e,r){if(e<0)return t;var n=parseInt(e/4,10),a=e%4;if(n>=t.length)throw new Error("length exceed ".concat(n));var o=t.charAt(n),i=Math.pow(2,3-a);return o=r?(i|parseInt(o,16)).toString(16):(~i&parseInt(o,16)).toString(16),t.substring(0,n)+o+t.substring(n+1).toUpperCase()}}]),t}(),f=function(){function t(){c()(this,t);var e="00000000000000000000000000000000";this.mask=e,this.bitMap=e}return h()(t,[{key:"init",value:function(t){this.bitMap=null==t?this.mask:t}},{key:"setBit",value:function(t,e){t<2||t>128||(this.bitMap=l.bitSet(this.bitMap,t-1,e))}},{key:"checkBit",value:function(t){return!(t<2||t>128)&&l.bitGet(this.bitMap,t-1)}},{key:"toString",value:function(){return this.bitMap.toUpperCase()}}]),t}(),p=function(){function t(e){c()(this,t),this.superDecorator=e}return h()(t,[{key:"decorate",value:function(t,e){var r=t;return this.superDecorator&&(r=this.superDecorator.decorate(r,e)),l.bcdToAsc(r,r.length)}},{key:"recover",value:function(t,e){var r=t;return this.superDecorator&&(r=this.superDecorator.recover(r,e)),l.ascToBcd(r,r.length)}}]),t}(),v=function(){function t(e){c()(this,t),this.superDecorator=e}return h()(t,[{key:"decorate",value:function(t,e){var r=t;return this.superDecorator&&(r=this.superDecorator.decorate(r,e)),r}},{key:"recover",value:function(t,e){var r=t;return this.superDecorator&&(r=this.superDecorator.recover(r,e)),r}}]),t}(),d=function(){function t(e,r){c()(this,t),this.superDecorator=e,this.transfer=r}return h()(t,[{key:"decorate",value:function(t,e){var r=t;this.superDecorator&&(r=this.superDecorator.decorate(r,e));var n="B"===e.dataType||"ANS"===e.dataType?2*e.maxLength:e.maxLength;if(r.length>n)throw Error("data.length overflow, data=[".concat(r,"]"));return r.length%2&&(r+=e.padding),r}},{key:"recover",value:function(t,e){var r=t;this.superDecorator&&(r=this.superDecorator.recover(r,e));var n="B"===e.dataType||"ANS"===e.dataType?2*e.maxLength:e.maxLength;return this.transfer&&(this.transfer.data=r.slice(n)),r.slice(0,n)}}]),t}(),y=function(){function t(e,r){c()(this,t),this.superDecorator=e,this.transfer=r}return h()(t,[{key:"decorate",value:function(t,e){var r=t;this.superDecorator&&(r=this.superDecorator.decorate(r,e));var n="B"===e.dataType||"ANS"===e.dataType?2*e.maxLength:e.maxLength;if(r.length>n)throw Error("data.length overflow, data=[".concat(r,"]"));var a="00";return"B"===e.dataType||"ANS"===e.dataType?a+=parseInt((r.length+1)/2,10):a+=r.length,r.length%2&&(r+=e.padding),a.slice(-2)+r}},{key:"recover",value:function(t,e){var r=t;this.superDecorator&&(r=this.superDecorator.recover(r,e));var n=parseInt(r.slice(0,2),10);return(n="B"===e.dataType||"ANS"===e.dataType?2*n:n)%2&&(n+=1),this.transfer&&(this.transfer.data=r.slice(2+n)),r.slice(2,n+2)}}]),t}(),g=function(){function t(e,r){c()(this,t),this.superDecorator=e,this.transfer=r}return h()(t,[{key:"decorate",value:function(t,e){var r=t;this.superDecorator&&(r=this.superDecorator.decorate(r,e));var n="B"===e.dataType||"ANS"===e.dataType?2*e.maxLength:e.maxLength;if(r.length>n)throw Error("data.length overflow, data=[".concat(r,"]"));var a="0000";return"B"===e.dataType||"ANS"===e.dataType?a+=parseInt((r.length+1)/2,10):a+=r.length,r.length%2&&(r+=e.padding),a.slice(-4)+r}},{key:"recover",value:function(t,e){var r=t;this.superDecorator&&(r=this.superDecorator.recover(r,e));var n=parseInt(r.slice(0,4),10);return(n="B"===e.dataType||"ANS"===e.dataType?2*n:n)%2&&(n+=1),this.transfer&&(this.transfer.data=r.slice(4+n)),r.slice(4,n+4)}}]),t}(),m=function(){function t(e){c()(this,t),this.superDecorator=e}return h()(t,[{key:"decorate",value:function(t,e){var r=t;if(this.superDecorator&&(r=this.superDecorator.decorate(r,e)),"FIX"!==e.lengthType)return r;for(var n=r.length;n<e.maxLength;n++)r+=String(e.padding);return r}},{key:"recover",value:function(t,e){var r=t;return this.superDecorator&&(r=this.superDecorator.recover(r,e)),r}}]),t}(),b=function(){function t(e){c()(this,t),this.superDecorator=e}return h()(t,[{key:"decorate",value:function(t,e){var r=t;if(this.superDecorator&&(r=this.superDecorator.decorate(r,e)),"FIX"!==e.lengthType)return r;for(var n="",a=0;a<e.maxLength-r.length;a++)n+=String(e.padding);return n+r}},{key:"recover",value:function(t,e){var r=t;return this.superDecorator&&(r=this.superDecorator.recover(r,e)),r}}]),t}(),w=function(){function t(e){c()(this,t),this.attr=e}return h()(t,[{key:"getDataDecorator",value:function(){return{ANS:p,N:v,Z:v,B:v}[this.attr.dataType]}},{key:"getLengthDecorator",value:function(){return{FIX:d,LLVAR:y,LLLVAR:g}[this.attr.lengthType]}},{key:"getAlignDecorator",value:function(){return{LEFT:m,RIGHT:b}[this.attr.alignment]}}]),t}(),x=new(function(){function t(){c()(this,t),this.isEnable=!1}return h()(t,[{key:"enable",value:function(){this.isEnable=!0}},{key:"disable",value:function(){this.isEnable=!1}},{key:"log",value:function(){var t;this.isEnable&&(t=console).log.apply(t,arguments)}}]),t}()),k=function(){function t(e){c()(this,t),this.attr=e,this.data=null;var r=new w(e),n=r.getDataDecorator(),a=r.getAlignDecorator(),o=r.getLengthDecorator();this.decorateFactory=r,this.sealDecorators=new o(new n(new a)),this.unsealDecorators=new a(new n(new o))}return h()(t,[{key:"setData",value:function(t){this.data=t}},{key:"getData",value:function(){return this.data}},{key:"setAttr",value:function(t){this.attr=t}},{key:"getAttr",value:function(){return this.attr}},{key:"seal",value:function(){return x.log("#seal field- ".concat(this.attr.bitNo," # - [").concat(this.data,"]")),this.sealDecorators.decorate(this.data,this.attr)}},{key:"unseal",value:function(t){var e={data:t};return this.data=this.unsealDecorators.recover(t,this.attr),x.log("#unseal field- ".concat(this.attr.bitNo," # - [").concat(this.data,"]")),new(this.decorateFactory.getLengthDecorator())(null,e).recover(t,this.attr),e.data}}]),t}();r.d(e,"default",function(){return D}),r.d(e,"ISO8583",function(){return D});var D=function(){function t(){c()(this,t),this.iso8583Map=new Array(129),this.bFields128=!1,this.macGenerate=null,this.headerDecorate=null,this.attrMessageType={bitNo:0,dataType:"N",lengthType:"FIX",maxLength:4,alignment:"RIGHT",padding:"0",describe:""},this.attrBitmap={bitNo:1,dataType:"B",lengthType:"FIX",maxLength:8,alignment:"RIGHT",padding:"0",describe:""},this.bitMap=new f}return h()(t,[{key:"init",value:function(t){var e,r=this;t.forEach(function(t){if("function"!=typeof t){var n=new k(t);r.iso8583Map[t.bitNo]=n,e=t}},this),e.bitNo>64?(this.bFields128=!0,this.attrBitmap.maxLength=16):(this.bFields128=!1,this.attrBitmap.maxLength=8),this.iso8583Map[0]=new k(this.attrMessageType),this.iso8583Map[1]=new k(this.attrBitmap)}},{key:"setMacGenerate",value:function(t){this.macGenerate=t}},{key:"setHeaderDecorate",value:function(t){this.headerDecorate=t}},{key:"set",value:function(t,e){null!=e&&(this.iso8583Map[t].setData(e),t>=2&&this.bitMap.setBit(t,!0))}},{key:"get",value:function(t){return this.iso8583Map[t].getData()}},{key:"clear",value:function(t){this.iso8583Map[t].setData(null),this.bitMap.setBit(t,!1)}},{key:"clearAll",value:function(){var t=this;this.iso8583Map.forEach(function(e,r){e&&(e.setData(null),t.bitMap.setBit(r,!1))},this)}},{key:"pack",value:function(){var t=i()(a.a.mark(function t(e){var r,n,o,i,s,c,u=this;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r="",e.isGenMac&&this.bitMap.setBit(this.bFields128?128:64,!0),n=this.bFields128?16:8,this.iso8583Map[this.attrBitmap.bitNo].setData(this.bitMap.toString().slice(0,2*n)),r+=this.iso8583Map[0].seal(),r+=this.iso8583Map[1].seal(),this.iso8583Map.forEach(function(t,e){u.bitMap.checkBit(e)&&+e!=(u.bFields128?128:64)&&t&&(r+=t.seal())},this),!e.isGenMac){t.next=12;break}return t.next=10,this.macGenerate.generate(r);case 10:o=t.sent,r+=o;case 12:return r=this.headerDecorate.decorate(r),i=parseInt(r.length/2/256,10).toString(16),s=(parseInt(r.length/2,10)%256).toString(16),c="00".concat(i).slice(-2)+"00".concat(s).slice(-2),r=c.slice(-4)+r,t.abrupt("return",r);case 18:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"unpack",value:function(){var t=i()(a.a.mark(function t(e){var r,n,o,i=this;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=this.headerDecorate.recover(e.data.slice(4)),t.prev=1,r=this.iso8583Map[0].unseal(n),r=this.iso8583Map[1].unseal(r),t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:if(x.log("#bitmap# ".concat(this.iso8583Map[1].getData())),this.bitMap.init(this.iso8583Map[1].getData()),this.iso8583Map.forEach(function(t,e){i.bitMap.checkBit(e)&&t&&(r=t.unseal(r))},this),!e.isVerifyMac){t.next=18;break}if(o=n.slice(-16),n=n.slice(0,-16),!("00 10 11 A2 A4 A5 A6".split(" ").indexOf(this.iso8583Map[39].getData())>=0)){t.next=18;break}return t.next=18,this.macGenerate.verify(n,o);case 18:case"end":return t.stop()}},t,this,[[1,6]])}));return function(e){return t.apply(this,arguments)}}()}]),t}()}])});